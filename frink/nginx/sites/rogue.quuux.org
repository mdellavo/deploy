
server {
    listen 443 ssl;
    server_name rogue.quuux.org;

    ssl_certificate /etc/letsencrypt/live/rogue.quuux.org/fullchain.pem;
    ssl_certificate_key /etc/letsencrypt/live/rogue.quuux.org/privkey.pem;
    include /etc/letsencrypt/options-ssl-nginx.conf;
    ssl_dhparam /etc/letsencrypt/ssl-dhparams.pem;

    location / {
      proxy_http_version     1.1;
      proxy_set_header       Connection "";
      proxy_set_header       Authorization '';
      proxy_set_header       Host rogue.quuux.org.s3-website-us-east-1.amazonaws.com;
      proxy_hide_header      x-amz-id-2;
      proxy_hide_header      x-amz-request-id;
      proxy_hide_header      x-amz-meta-server-side-encryption;
      proxy_hide_header      x-amz-server-side-encryption;
      proxy_hide_header      Set-Cookie;
      proxy_ignore_headers   Set-Cookie;
      proxy_cache_revalidate on;
      proxy_intercept_errors on;
      proxy_pass             http://rogue.quuux.org.s3-website-us-east-1.amazonaws.com;
      proxy_cache            cache;
      proxy_cache_valid      200 24h;
      proxy_cache_valid      403 15m;
      proxy_cache_use_stale  error timeout updating http_500 http_502 http_503 http_504;
      proxy_cache_lock       on;
      proxy_cache_bypass     $http_cache_purge;
      add_header             Cache-Control max-age=31536000;
      add_header             X-Cache-Status $upstream_cache_status;
    }
}

server {
    listen 80;
    server_name rogue.quuux.org;

    if ($host = rogue.quuux.org) {
        return 301 https://$host$request_uri;
    }

    return 404;
}
